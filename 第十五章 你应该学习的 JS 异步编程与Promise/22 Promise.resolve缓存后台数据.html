<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>22 Promise.resolveç¼“å­˜åå°æ•°æ®</title>
  </head>
  <body></body>
  <script src="ajax.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script>
    function query(name) {
      const cache = query.cache || (query.cache = new Map()) //functionæœ¬èº«å°±æ˜¯ä¸€ä¸ªObjectï¼Œ å¯ä»¥ç»™queryè¿™ä¸ªObjectæ·»åŠ ä¸€ä¸ªå±æ€§

      if (cache.has(name)) {
        console.log('èµ°ç¼“å­˜')
        return Promise.resolve(cache.get(name))
      }
      return ajax(`http://localhost:4000/user/playlist?uid=${name}`).then(
        (result) => {
          console.log('æ²¡æœ‰èµ°ç¼“å­˜')
          cache.set(name, result)
          console.log(
            'ğŸš€ ~ file: 22 Promise.resolveç¼“å­˜åå°æ•°æ®.html ~ line 26 ~ query ~ cache',
            cache,
          )
          return result
        },
      )
    } //è¦æœ‰è¿™å¥è¯æ‰èƒ½èµ°ç¼“å­˜ï¼Œå¦‚æœç›´æ¥å†™setTimeOutçš„è¯ å°±æ²¡æœ‰ç¼“å­˜ï¼Œæˆ–è€…æ˜¯ä¸‹é¢çš„æ—¶é—´ä¸åŒæ‰ä¼šèµ°ç¼“å­˜
    /*
    query('32953014').then((result) => {
      console.log('ğŸš€ ~ file:~ from query function result', result)
    })
    */

    setTimeout(() => {
      query('32953014').then((result) => {
        console.log('ğŸš€ ~ file:~setTimeout ', result)
      })
    }, 1000)
    setTimeout(() => {
      query('32953014').then((result) => {
        console.log('ğŸš€ ~ file:~ setTimeout', result)
      })
    }, 5000)
  </script>
</html>
