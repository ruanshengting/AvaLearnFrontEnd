<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>30 ä½¿ç”¨é˜Ÿåˆ—æ¸²æŸ“æ•°æ®</title>
  </head>
  <body></body>
  <script>
    class User {
      ajax(user, urlParam) {
        let url = urlParam + `${user}`
        return new Promise((resolve, reject) => {
          let xhr = new XMLHttpRequest() //åŸºäº new å‡ºæ¥çš„ XMLHttpRequest å®ä¾‹å¯¹è±¡, å¯ä»¥å‘èµ· Ajax çš„è¯·æ±‚ã€‚
          xhr.open('GET', url) //è°ƒç”¨ open() æ–¹æ³•åˆ›å»ºè¯·æ±‚, xhr.open('è¯·æ±‚æ–¹å¼', 'è¯·æ±‚è·¯å¾„'...)
          xhr.send() // è°ƒç”¨ send() å‘é€è¯·æ±‚
          xhr.onload = function () {
            //onload: æ¥æ”¶å¾—åˆ°çš„æ•°æ®
            if (this.status == 200) {
              console.log(
                'ğŸš€ ~JSON.parse(this.response)ï¼ŒurlParam',
                urlParam,
                JSON.parse(this.response),
              )
              resolve(JSON.parse(this.response))
            } else {
              reject('åŠ è½½å¤±è´¥')
            }
          }
          xhr.onerror = function () {
            reject('åŠ è½½å¤±è´¥ onerror' + this)
          }
        })
      }
      render(users) {
        users.reduce((promise, user) => {
          return promise
            .then(() => {
              return this.ajax(user, 'http://localhost:4000/search?keywords=')
            })
            .then((user) => {
              return this.view(user, user.result.songs[3].name)
            })
            .then((user) => {
              console.log(
                'ğŸš€ ~ file: 30  user.result.songs[3].mvid=',
                user.result.songs[3].mvid,
              )
              return this.ajax(
                user.result.songs[3].mvid,
                'http://localhost:4000/comment/mv?id=',
              ) //å¿˜è®°å†™è¿”å›ï¼ˆreturnï¼‰äº†ï¼ï¼ï¼
            })
            .then((comment) => {
              console.log(
                'ğŸš€ ~ file: 30 ä½¿ç”¨é˜Ÿåˆ—æ¸²æŸ“æ•°æ®.html ~ line 51 ~ User ~ .then ~ comment',
                comment,
              )
              return this.view(comment, comment.comments[3].content)
            })
            .catch((err) => {
              console.log(err)
            })
        }, Promise.resolve())
      }
      view(user, propertyPath) {
        return new Promise((resolve) => {
          let h2
          h2 = document.createElement('h4')
          h2.innerHTML = propertyPath
          document.body.appendChild(h2)
          resolve(user) //å¦‚æœä¸åŠ è¿™ä¸€å¥ï¼Œå°±åªæœ‰ç¬¬ä¸€æ¡æ•°æ®äº†
        })
      }
    }
    //http://localhost:4000/comment/mv?id=14364882
    /*
        è·å–è§†é¢‘æ’­æ”¾åœ°å€
        è¯´æ˜ : è°ƒç”¨æ­¤æ¥å£ , ä¼ å…¥è§†é¢‘ id,å¯è·å–è§†é¢‘æ’­æ”¾åœ°å€

        å¿…é€‰å‚æ•° : id: è§†é¢‘ çš„ id

        æ¥å£åœ°å€ : /video/url

        è°ƒç”¨ä¾‹å­ : /video/url?id=89ADDE33C0AAE8EC14B99F6750DB954D
        */
    new User().render(['AOA', 'aespa', 'è”¡ä¾æ—'])
  </script>
</html>
