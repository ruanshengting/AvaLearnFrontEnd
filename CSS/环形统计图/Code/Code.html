<html lang="zh">
  <head>
    <meta charset="utf-8" />
    <title>é¥¼å›¾demo</title>
    <style>
      .pie {
        width: 300px;
        height: 300px;
        position: relative;
      }

      .pie .sector {
        position: absolute;
        width: 100%;
        height: 100%;
        transition: all 0.3s ease-in;
      }

      .pie .sector:hover {
        transform: scale(1.1);
      }

      .pie .title {
        display: none;
      }

      .pie .sector:hover + .title {
        position: absolute;
        top: 50%;
        left: 110%;
        width: 120px;
        transform: translateY(-50%);
        display: block;
      }
      /*å˜æˆç¯å½¢ï¼šæ·»åŠ ä¸­é—´çš„ç™½å¿ƒ*/
      .container {
        position: relative;
      }
      .center {
        position: absolute;
        top: 77px;
        left: 75px;
        width: 150px;
        height: 150px;
        border-radius: 50%;
        background-color: #fff;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div id="pie"></div>
      <div class="center"></div>
    </div>

    <script>
      const data = [
        { ratio: 0.55, title: 'Python 55%' },
        { ratio: 0.35, title: 'C 35%' },
        { ratio: 0.1, title: 'Java 10%' },
        /*
        { ratio: 0.0829, title: 'C++ 8.29%' },
        { ratio: 0.0568, title: 'C# 5.68%' },
        { ratio: 0.0474, title: 'Visual Basic 4.74%' },
        { ratio: 0.0209, title: 'JavaScript 2.09%' },
        { ratio: 0.4252, title: 'Other 42.52%' },
        */
      ]

      function execPoint(cx, cy, r, ratio) {
        /*(cx,cy)æ˜¯åœ†å½¢åæ ‡ï¼Œræ˜¯åŠå¾„ï¼Œradioæ˜¯å æ¯”çš„ç´¯åŠ ï¼ˆèŒƒå›´æ˜¯0-1ï¼‰*/
        // è®¡ç®—å¼§åº¦ï¼Œä¸€ä¸ªæ•´åœ†å¼§åº¦æ˜¯ 2Ï€
        const rad = ratio * 2 * Math.PI
        console.log('cx + Math.sin(rad) * r=', cx + Math.sin(rad) * r)
        return {
          x: cx + Math.sin(rad) * r,
          y: cy - Math.cos(rad) * r,
        }
      }

      /**
       * æ„å»ºè£å‰ªè·¯å¾„
       * @param data æ•°æ®
       * @param width å…ƒç´ å®½åº¦ï¼Œå®½é«˜ç›¸åŒ
       */
      function buildSectorPaths(data, width) {
        // åè½¬é‡
        let offset = 0
        // åœ†å¿ƒåæ ‡
        const cx = width / 2
        const cy = width / 2
        // åŠå¾„
        const r = width / 2
        const result = []
        for (const datum of data) {
          /*M ç§»åŠ¨ï¼ŒL ç»˜åˆ¶ç›´çº¿ï¼ŒA ç»˜åˆ¶å¼§å½¢ï¼ŒZ å…³é—­è·¯å¾„*/
          let path = `M ${cx},${cy}`
          // åœ†å¼§èµ·ç‚¹
          const start = execPoint(cx, cy, r, offset)
          path += ` L ${start.x},${start.y}`
          // åœ†å¼§ç»ˆç‚¹
          offset += datum.ratio
          console.log('ğŸš€  ~ offset', offset)
          const end = execPoint(cx, cy, r, offset)
          // åœ†å¼§å¤§å…³åœ†ç”»å¤§åœ†ï¼Œå¦åˆ™ç”»å°åœ†
          const angle = datum.ratio * 2 * Math.PI
          path += ` A ${r},${r} 0,${angle > Math.PI ? 1 : 0},1 ${end.x},${
            end.y
          }`
          path += ' Z'
          result.push(path)
        }
        return result
      }

      function buildPie(containerEl, data) {
        containerEl.classList.add('pie')
        const paths = buildSectorPaths(data, 300)
        for (let i = 0; i < paths.length; i++) {
          const path = paths[i]
          const sector = document.createElement('div')
          sector.classList.add('sector')
          sector.style.clipPath = `path('${path}')`
          // ç»™ä¸ªéšæœºèƒŒæ™¯è‰²
          const r = Math.floor(Math.random() * 255)
          const g = Math.floor(Math.random() * 255)
          const b = Math.floor(Math.random() * 255)
          sector.style.backgroundColor = `rgb(${r},${g},${b})`
          containerEl.appendChild(sector)
          // æ–°å¢åŠ çš„æ ‡é¢˜
          const title = document.createElement('div')
          title.classList.add('title')
          title.innerText = data[i].title
          containerEl.appendChild(title)
        }
      }

      const pie = document.getElementById('pie')
      buildPie(pie, data)
    </script>
  </body>
</html>
<!--å‚è€ƒï¼š https://juejin.cn/post/7054924254952816676#comment -->
